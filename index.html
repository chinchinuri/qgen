<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Генератор QR-кодів</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/qrious@4.0.2/dist/qrious.min.js"></script>
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-4">Генератор QR-кодів</h1>
        <div class="row">
            <div class="col-md-6">
                <form id="qr-form">
                    <div class="mb-3">
                        <label for="qr-text" class="form-label">Текст для QR-коду:</label>
                        <input type="text" class="form-control" id="qr-text" required>
                    </div>
                    <div class="mb-3">
                        <label for="qr-size" class="form-label">Розмір (пікселі):</label>
                        <input type="number" class="form-control" id="qr-size" value="512" min="128" max="1024">
                    </div>
                    <div class="mb-3">
                        <label for="qr-background" class="form-label">Колір фону:</label>
                        <input type="color" class="form-control" id="qr-background" value="#ffffff">
                    </div>
                    <div class="mb-3">
                        <label for="qr-foreground" class="form-label">Колір елементів:</label>
                        <input type="color" class="form-control" id="qr-foreground" value="#000000">
                    </div>
                    <div class="mb-3">
                        <label for="qr-background-radius" class="form-label">Округлість кутів фону:</label>
                        <input type="range" class="form-range" id="qr-background-radius" min="0" max="50" value="0">
                    </div>
                    <div class="mb-3">
                        <label for="qr-dot-radius" class="form-label">Округлість кутів крапок:</label>
                        <input type="range" class="form-range" id="qr-dot-radius" min="0" max="50" value="0">
                    </div>
                    <div class="mb-3">
                        <label for="qr-corner-radius" class="form-label">Округлість кутів елементів позиціонування:</label>
                        <input type="range" class="form-range" id="qr-corner-radius" min="0" max="50" value="0">
                    </div>
                    <div class="mb-3">
                        <label for="qr-margin" class="form-label">Поля (модулі):</label>
                        <input type="number" class="form-control" id="qr-margin" value="4" min="0" max="10">
                    </div>
                    <button type="submit" class="btn btn-primary">Згенерувати QR-код</button>
                </form>
            </div>
            <div class="col-md-6">
                <canvas id="qr-canvas"></canvas>
                <div class="mt-3">
                    <button id="save-svg" class="btn btn-success">Зберегти як SVG</button>
                </div>
            </div>
        </div>
    </div>

    <script>
    const qrCanvas = document.getElementById('qr-canvas');
    const qrForm = document.getElementById('qr-form');
    const saveSvgBtn = document.getElementById('save-svg');

    let qr;

    qrForm.addEventListener('submit', function(e) {
        e.preventDefault();
        generateQR();
    });

    saveSvgBtn.addEventListener('click', saveSVG);

    function generateQR() {
        const text = document.getElementById('qr-text').value;
        const size = parseInt(document.getElementById('qr-size').value);
        const background = document.getElementById('qr-background').value;
        const foreground = document.getElementById('qr-foreground').value;
        const backgroundRadius = parseInt(document.getElementById('qr-background-radius').value);
        const dotRadius = parseInt(document.getElementById('qr-dot-radius').value);
        const cornerRadius = parseInt(document.getElementById('qr-corner-radius').value);
        const margin = parseInt(document.getElementById('qr-margin').value);

        qr = new QRious({
            value: text,
            size: size,
            background: background,
            foreground: foreground,
            level: 'H',
            padding: margin
        });

        // Малюємо QR-код на canvas для попереднього перегляду
        const ctx = qrCanvas.getContext('2d');
        qrCanvas.width = size;
        qrCanvas.height = size;
        ctx.fillStyle = background;
        ctx.fillRect(0, 0, size, size);
        ctx.drawImage(qr.image, 0, 0, size, size);
    }

    function saveSVG() {
        const svg = generateSVG();
        const blob = new Blob([svg], {type: 'image/svg+xml;charset=utf-8'});
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = getFileName();
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }

    function generateSVG() {
        const size = parseInt(document.getElementById('qr-size').value);
        const background = document.getElementById('qr-background').value;
        const foreground = document.getElementById('qr-foreground').value;
        const backgroundRadius = parseInt(document.getElementById('qr-background-radius').value);
        const dotRadius = parseInt(document.getElementById('qr-dot-radius').value);
        const cornerRadius = parseInt(document.getElementById('qr-corner-radius').value);
        const margin = parseInt(document.getElementById('qr-margin').value);
        
        const svgNS = "http://www.w3.org/2000/svg";
        const svg = document.createElementNS(svgNS, "svg");
        svg.setAttribute("width", size);
        svg.setAttribute("height", size);
        svg.setAttribute("viewBox", `0 0 ${size} ${size}`);

        // Додаємо фон з округленими кутами
        const background_rect = document.createElementNS(svgNS, "rect");
        background_rect.setAttribute("width", size);
        background_rect.setAttribute("height", size);
        background_rect.setAttribute("fill", background);
        background_rect.setAttribute("rx", backgroundRadius);
        background_rect.setAttribute("ry", backgroundRadius);
        svg.appendChild(background_rect);

        const moduleCount = qr.modules;
        const moduleSize = size / moduleCount;

        // Створюємо групу для всіх модулів QR-коду
        const qrGroup = document.createElementNS(svgNS, "g");
        svg.appendChild(qrGroup);

        for (let row = 0; row < moduleCount; row++) {
            for (let col = 0; col < moduleCount; col++) {
                if (qr.qrious.modules[row][col]) {
                    const x = col * moduleSize;
                    const y = row * moduleSize;
                    
                    const module = document.createElementNS(svgNS, "rect");
                    module.setAttribute("x", x);
                    module.setAttribute("y", y);
                    module.setAttribute("width", moduleSize);
                    module.setAttribute("height", moduleSize);
                    module.setAttribute("fill", foreground);

                    if (isPositioningSquare(col, row, moduleCount)) {
                        module.setAttribute("rx", cornerRadius);
                        module.setAttribute("ry", cornerRadius);
                    } else {
                        module.setAttribute("rx", dotRadius);
                        module.setAttribute("ry", dotRadius);
                    }

                    qrGroup.appendChild(module);
                }
            }
        }

        return new XMLSerializer().serializeToString(svg);
    }

    function isPositioningSquare(x, y, size) {
        return (x < 7 && y < 7) || (x > size - 8 && y < 7) || (x < 7 && y > size - 8);
    }

    function getFileName() {
        const now = new Date();
        const year = now.getFullYear();
        const month = String(now.getMonth() + 1).padStart(2, '0');
        const day = String(now.getDate()).padStart(2, '0');
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        return `${year}-${month}-${day}-${hours}-${minutes}-${seconds}.svg`;
    }
</script>
</body>
</html>
